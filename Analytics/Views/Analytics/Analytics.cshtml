
@{
    Layout = null;
}

<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>GOpe URL </title>

    <!-- Bootstrap -->
    <link href="../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="../vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- Animate.css -->
    <link href="../vendors/animate.css/animate.min.css" rel="stylesheet">
    <!-- bootstrap-daterangepicker -->
    <link href="../vendors/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">

    <!--highcharts-->
    <link href="https://code.highcharts.com/css/highcharts.css" rel="stylesheet">
    <link href="https://code.highcharts.com/5.0.0/css/highcharts.css" rel="stylesheet">

    <!-- Custom Theme Style -->
    <link href="../css/app.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="https://code.highcharts.com/highcharts.js"></script>
</head>

<body class="login">
    <header class="navbar navbar-static-top bs-docs-nav" id="top" role="banner" style="background: #333">
        <div class="container">
            <div class="top_nav">
                <div class="navbar-header">
                    <a href="index.html" class="site_title"><i class="fa fa-link"></i> <span>GOpe URL</span></a>
                </div>
            </div>
        </div>
    </header>
    <div>
        <div class="container body">
            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="panel panel-default">
                        <div class="panel-body">
                            <h1>Welcome User</h1>
                            <p>Your Long URL: <a id="url" class="green" target="_blank"></a></p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="panel panel-default">
                        <div class="panel-body tile_count">
                            <div class="col-md-4 col-sm-4 col-xs-4 tile_stats_count">
                                <span class="count_top"><i class="fa fa-eye"></i> Total Visits</span>
                                <div class="count" id="visits_total">0</div>
                                <span class="count_bottom"><i class="green"><span id="visits_percentage"></span>% </i> From last day</span>
                            </div>
                            <div class="col-md-4 col-sm-4 col-xs-4 tile_stats_count">
                                <span class="count_top"><i class="fa fa-user"></i> Unique User Visits</span>
                                <div class="count" id="unique_users_total">0</div>
                                <span class="count_bottom"><i class="green"><span id="unique_users_percentage"></span>% </i> From last day</span>
                            </div>
                            <div class="col-md-4 col-sm-4 col-xs-4 tile_stats_count">
                                <span class="count_top"><i class="fa fa-users"></i> Total Users</span>
                                <div class="count green" id="total_users">0</div>
                                <span class="count_bottom">&nbsp;</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="panel panel-default">
                        <div class="row">
                            <div class="col-md-12 col-sm-12 col-xs-12">
                                <div class="dashboard_graph">

                                    <div class="row x_title">
                                        <div class="col-md-6">
                                            <h3>User Activities<small style="padding-left: 10px">timeline presentation</small></h3>
                                        </div>
                                        <div class="col-md-6">
                                            <div id="reportrange" class="pull-right" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc">
                                                <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>
                                                <span>December 30, 2014 - January 28, 2015</span> <b class="caret"></b>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-md-12 col-sm-12 col-xs-12">
                                        <div id="placeholder33" style="height: 260px; display: none" class="demo-placeholder"></div>
                                        <div style="width: 100%;">
                                            <div id="canvas_dahs" class="demo-placeholder" style="width: 100%; height:270px;"></div>
                                        </div>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="panel panel-default">
                        <div class="row">
                            <div class="col-md-12 col-sm-12 col-xs-12">
                                <div class="dashboard_graph">

                                    <div class="row x_title">
                                        <div class="col-md-6">
                                            <h3>Visitors location <small>geo-presentation</small></h3>
                                        </div>
                                    </div>

                                    <div class="col-md-12 col-sm-12 col-xs-12">
                                        <div style="width: 100%;">
                                            <div id="world-map-gdp" class="columnscol-md-12 col-sm-12 col-xs-12" style="height: 400px">
                                                <div class="loading">
                                                    <i class="icon-spinner icon-spin icon-large"></i>
                                                    Loading data from Google Spreadsheets...
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="clearfix"></div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="panel panel-default">
                        <div class="row">
                            <div class="col-md-6 col-sm-6 col-xs-6">
                                <div class="dashboard_graph row">

                                    <div class="row x_title">
                                        <div class="col-md-12">
                                            <h3>Devices</h3>
                                        </div>
                                    </div>

                                    <div class="col-md-12 col-sm-12 col-xs-12">
                                        <div id="placeholder33" style="height: 260px; display: none" class="demo-placeholder"></div>
                                        <div style="width: 100%;">
                                            <div id="devices-chart" class="col-md-8 col-sm-12 col-xs-12" style="height:230px;"></div>
                                        </div>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-6 col-xs-6">
                                <div class="dashboard_graph ">

                                    <div class="row x_title">
                                        <div class="col-md-12">
                                            <h3>Platforms</h3>
                                        </div>
                                    </div>

                                    <div class="col-md-12 col-sm-12 col-xs-12">
                                        <div id="placeholder33" style="height: 260px; display: none" class="demo-placeholder"></div>
                                        <div style="width: 100%;">
                                            <div id="platform-chart" class="col-md-8 col-sm-12 col-xs-12" style="height:230px;"></div>
                                        </div>
                                    </div>
                                    <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- jQuery -->
    <script src="../vendors/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="../vendors/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- bootstrap-daterangepicker -->
    <script src="../vendors/moment/min/moment.min.js"></script>
    <script src="../vendors/bootstrap-daterangepicker/daterangepicker.js"></script>

    <script src="https://code.highcharts.com/highcharts-more.js"></script>

    <script src="https://code.highcharts.com/maps/highmaps.js"></script>
    <script src="https://code.highcharts.com/maps/js/modules/map.js"></script>
    <script src="https://code.highcharts.com/maps/modules/data.js"></script>
    <script src="https://code.highcharts.com/mapdata/custom/world.js"></script>

    <script>
    $(function () {
        var getSummary = function() {
            $.getJSON('summary.json', function (data) {
                $('#url').html(data.url).attr('href',data.url);
                $('#total_users').html(data.total_users.total);
                $('#unique_users_total').html(data.unique_users.total || 0);
                $('#unique_users_percentage').html(data.unique_users.change || 0);
                $('#visits_total').html(data.visits.total || 0);
                $('#visits_percentage').html(data.visits.change || 0);
            });
        };

        var getCounts = function(start, end){
            //$.getJSON('data.json?from='+start+'&to='+end, function (data) {
            $.getJSON('/Service1.svc/GETALLCOUNTS?Fk_Uniqueid=9&DateFrom=' + start + '&DateTO=' + end, function (data) {
                Highcharts.chart('canvas_dahs', {
                    chart: {
                        zoomType: 'x'
                    },
                    title: {
                        text: 'user activities over time'
                    },
                    subtitle: {
                        text: document.ontouchstart === undefined ?
                                'Click and drag in the plot area to zoom in' : 'Pinch the chart to zoom in'
                    },
                    xAxis: {
                        type: 'datetime'
                    },
                    yAxis: {
                        title: {
                            text: 'Counts'
                        }
                    },
                    legend: {
                        enabled: false
                    },
                    plotOptions: {
                        area: {
                            fillColor: {
                                linearGradient: {
                                    x1: 0,
                                    y1: 0,
                                    x2: 0,
                                    y2: 1
                                },
                                stops: [
                                    [0, Highcharts.getOptions().colors[0]],
                                    [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                                ]
                            },
                            marker: {
                                radius: 2
                            },
                            lineWidth: 1,
                            states: {
                                hover: {
                                    lineWidth: 1
                                }
                            },
                            threshold: null
                        }
                    },

                    series: [{
                        type: 'area',
                        name: 'Count',
                        data: data.activity
                    }]
                });

                Highcharts.chart('devices-chart', {
                    chart: {
                        plotBackgroundColor: null,
                        plotBorderWidth: null,
                        plotShadow: false,
                        type: 'pie'
                    },
                    title: {
                        text: ''
                    },
                    tooltip: {
                        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: true,
                            cursor: 'pointer',
                            dataLabels: {
                                enabled: false,
                                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                                style: {
                                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                                }
                            },
                            showInLegend: false
                        }
                    },
                    series: [{
                        name: 'Brands',
                        colorByPoint: true,
                        data: data.devices
                    }]
                });

                Highcharts.chart('platform-chart', {
                    chart: {
                        plotBackgroundColor: null,
                        plotBorderWidth: null,
                        plotShadow: false,
                        type: 'pie'
                    },
                    title: {
                        text: ''
                    },
                    tooltip: {
                        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                    },
                    plotOptions: {
                        pie: {
                            allowPointSelect: true,
                            cursor: 'pointer',
                            dataLabels: {
                                enabled: false,
                                format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                                style: {
                                    color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                                }
                            },
                            showInLegend: false
                        }
                    },
                    series: [{
                        name: 'Brands',
                        colorByPoint: true,
                        data: data.platforms
                    }]
                });

                Highcharts.mapChart('world-map-gdp', {
                    chart: {
                        borderWidth: 1
                    },

                    colors: ['rgba(19,64,117,0.05)', 'rgba(19,64,117,0.2)', 'rgba(19,64,117,0.4)',
                        'rgba(19,64,117,0.5)', 'rgba(19,64,117,0.6)', 'rgba(19,64,117,0.8)', 'rgba(19,64,117,1)'],

                    title: {
                        text: ''
                    },

                    mapNavigation: {
                        enabled: false
                    },

                    legend: {
                        title: {
                            text: 'User Visits',
                            style: {
                                color: (Highcharts.theme && Highcharts.theme.textColor) || 'black'
                            }
                        },
                        align: 'left',
                        verticalAlign: 'bottom',
                        floating: true,
                        layout: 'vertical',
                        valueDecimals: 0,
                        backgroundColor: (Highcharts.theme && Highcharts.theme.legendBackgroundColor) || 'rgba(255, 255, 255, 0.85)',
                        symbolRadius: 0,
                        symbolHeight: 14
                    },

                    colorAxis: {
                        dataClasses: [{
                            to: 3
                        }, {
                            from: 3,
                            to: 10
                        }, {
                            from: 10,
                            to: 30
                        }, {
                            from: 30,
                            to: 100
                        }, {
                            from: 100,
                            to: 300
                        }, {
                            from: 300,
                            to: 1000
                        }, {
                            from: 1000
                        }]
                    },

                    series: [{
                        data: data.locations,
                        mapData: Highcharts.maps['custom/world'],
                        joinBy: ['iso-a2', 'code'],
                        animation: true,
                        name: 'Activity Count',
                        states: {
                            hover: {
                                color: '#a4edba'
                            }
                        },
                        tooltip: {
                            valueSuffix: ' Visits'
                        }
                    }]
                });

            });
        };

        var cb = function(start, end, label) {
            console.log("callback", start.toISOString(), end.toISOString(), label);
            $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
            getCounts(start.format('MM/DD/YYYY'), end.format('MM/DD/YYYY'));
        };

        var optionSet1 = {
            startDate: moment().subtract(29, 'days'),
            endDate: moment(),
            minDate: '12/01/2014',
            maxDate: moment().format('MM/DD/YYYY'),
            dateLimit: {
                days: 60
            },
            showDropdowns: true,
            showWeekNumbers: true,
            timePicker: false,
            timePickerIncrement: 1,
            timePicker12Hour: true,
            ranges: {
                'Today': [moment(), moment()],
                'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                'This Month': [moment().startOf('month'), moment().endOf('month')],
                'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
            },
            opens: 'left',
            buttonClasses: ['btn btn-default'],
            applyClass: 'btn-small btn-primary',
            cancelClass: 'btn-small',
            format: 'MM/DD/YYYY',
            separator: ' to ',
            locale: {
                applyLabel: 'Submit',
                cancelLabel: 'Clear',
                fromLabel: 'From',
                toLabel: 'To',
                customRangeLabel: 'Custom',
                daysOfWeek: ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'],
                monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
                firstDay: 1
            }
        };

        getCounts(optionSet1.minDate, optionSet1.maxDate)
        getSummary();

        $('#reportrange span').html(moment().subtract(29, 'days').format('MMMM D, YYYY') + ' - ' + moment().format('MMMM D, YYYY'));
        $('#reportrange').daterangepicker(optionSet1, cb);
    });
    </script>

</body>
</html>
